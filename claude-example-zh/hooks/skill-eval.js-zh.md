# skill-eval.js - 技能评估引擎

## 文件概述

`skill-eval.js` 是 Claude Code 的核心技能评估引擎，用于智能地根据用户输入自动激活相关的技能。这是 v2.0 版本，基于多个因素进行智能分析：

- 提示中的关键词和模式
- 提及或正在编辑的文件路径
- 目录映射关系
- 意图检测
- 内容模式匹配

## 主要功能

### 1. 输入处理
- 从标准输入接收用户提示
- 支持 JSON 格式和纯文本输入
- 安全地处理输入并提取内容

### 2. 文件路径提取
- 检测提示中提到的文件路径
- 支持常见文件扩展名（.tsx, .ts, .jsx, .js, .json, .gql, .yaml, .yml, .md, .sh）
- 识别常见目录（src, app, components, screens, hooks, utils, services 等）
- 提取引号包围的路径

### 3. 技能评估算法
每个技能根据以下标准进行评分：

#### 匹配类型及分值：
- **关键字匹配**: 2分（简单关键词）
- **关键字模式**: 3分（正则表达式）
- **路径模式**: 4分（文件路径 glob 模式）
- **目录匹配**: 5分（目录到技能的映射）
- **意图模式**: 4分（用户意图检测）
- **内容模式**: 3分（代码片段中的模式）
- **上下文模式**: 2分（对话上下文）

#### 排除机制：
- 支持排除模式，避免不相关的技能被激活
- 例如：`["e2e", "maestro", "end-to-end"]` 排除端到端测试相关的技能

### 4. 相关技能推荐
- 根据已匹配的技能推荐相关技能
- 通过 `relatedSkills` 字段定义技能之间的关系

### 5. 输出格式
生成结构化的提醒信息，包含：
- 检测到的文件路径
- 按相关性排序的匹配技能
- 置信度级别（HIGH/MEDIUM/LOW）
- 匹配原因
- 相关技能建议

## 技术特点

### 1. 模式匹配
- 支持多种匹配模式：简单字符串、正则表达式、glob 模式
- 大小写不敏感的匹配
- 高效的正则表达式处理

### 2. 错误处理
- 优雅的错误处理，不会阻塞用户输入
- 详细的错误日志记录
- 优雅降级机制

### 3. 可配置性
- 通过外部 JSON 文件配置技能规则
- 支持动态加载和更新规则
- 可调整的最小置信度分数和最大显示数量

### 4. 性能优化
- 限制显示的技能数量
- 使用 Set 去重
- 高正则表达式缓存

## 使用流程

1. **输入分析**：分析用户提示中的关键词和文件路径
2. **技能评估**：对所有定义的技能进行评分
3. **排序筛选**：按分数和优先级排序，过滤低分技能
4. **生成输出**：格式化输出匹配的技能列表和相关建议
5. **技能激活**：引导用户评估和激活相关技能

## 集成方式

此脚本作为 Claude Code 的 hook 运行，在用户提交提示时自动触发，通过标准输入接收数据，处理后输出到标准输出。

```bash
# 典型的调用方式
cat | node skill-eval.js
```

## 注意事项

1. **Node.js 依赖**：需要 Node.js 环境运行
2. **配置文件**：依赖 `skill-rules.json` 配置文件
3. **性能考虑**：复杂的正则表达式可能影响性能
4. **错误处理**：即使评估失败也不会阻止用户提示的提交